import QRCodeStyling from 'qr-code-styling';
import { AsyncSubject } from 'rxjs';
import { Templates } from './ngx-qrcode-styling.templates';
/**
 * drawQrcode
 * @param config
 * @param container
 * @returns
 */
export function drawQrcode(config, container) {
    const subject = new AsyncSubject();
    // Reject
    if (!config || !container) {
        subject.error('Container or Config not available!');
        subject.complete();
        return subject;
    }
    ;
    const element = document.createElement("div");
    /**
     * QRCODE_NONE_FRAME
     * @returns
     */
    const QRCODE_NONE_FRAME = () => {
        if (config?.frameOptions) {
            return false;
        }
        else {
            const encodeConfig = () => {
                let deep = config && JSON.parse(JSON.stringify(config)); // deep
                return Object.assign({ data: window.unescape(encodeURIComponent(deep?.data ?? '')) }, deep);
            };
            // removeChild
            while (container.firstChild) {
                container.removeChild(container.lastChild);
            }
            const CR = new QRCodeStyling(encodeConfig());
            // append to container
            CR.append(container);
            return true;
        }
    };
    const styleName = config?.frameOptions?.style ?? 'F_020';
    const height = config?.frameOptions?.height ?? 300;
    const width = config?.frameOptions?.width ?? 300;
    const x = config?.frameOptions?.x ?? 50;
    const y = config?.frameOptions?.y ?? 50;
    /**
     * ADD_FRAME_SVG_TO_ELEMENT
     * @returns
     */
    const ADD_FRAME_SVG_TO_ELEMENT = () => {
        const http = fetch(`https://raw.githubusercontent.com/id1945/ngx-qrcode-styling/master/svg/${styleName}.svg`, { method: 'GET' });
        return new Promise((resolve, reject) => {
            http.then(response => response.text()).then(result => {
                if (result !== "404: Not Found") {
                    upgradeSvg(result);
                }
                resolve(result);
            }).catch(error => {
                console.error(error);
                reject(error);
            });
        });
    };
    const upgradeSvg = (result) => {
        const parser = new DOMParser();
        const doc = parser.parseFromString(result, "image/svg+xml");
        if (doc) {
            const svgEl = doc.documentElement.children[styleName + '_svg'];
            if (!svgEl)
                return;
            const textEls = svgEl.getElementsByClassName("frame-text");
            const contentEls = svgEl.getElementsByClassName("frame-content");
            const containerEls = svgEl.getElementsByClassName("frame-container");
            config?.frameOptions?.background && svgEl.setAttribute('style', `background: ${config?.frameOptions?.background};${svgEl?.getAttribute('style')}`);
            const updateStyle = (el, config) => {
                if (el) {
                    for (const key in config) {
                        if (['x', 'y', 'transform'].includes(key)) {
                            el.setAttribute(key, config && config[key]);
                        }
                        else if (['textContent'].includes(key)) {
                            el[key] = config && config[key];
                        }
                        else {
                            el.style[key] = config && config[key];
                        }
                    }
                }
            };
            const createElementNS = (config) => {
                const svgNS = "http://www.w3.org/2000/svg";
                const newText = document.createElementNS(svgNS, "text");
                updateStyle(newText, config);
                svgEl.appendChild(newText);
            };
            if (config?.frameOptions?.texts) {
                [...config.frameOptions.texts].forEach((text, i) => {
                    const el = [...textEls]?.[i];
                    el ? updateStyle(el, text) : createElementNS(text);
                });
            }
            if (config?.frameOptions?.containers) {
                [...containerEls].forEach((el, i) => {
                    updateStyle(el, config?.frameOptions?.containers?.[i]);
                });
            }
            if (config?.frameOptions?.contents) {
                [...contentEls].forEach((el, i) => {
                    updateStyle(el, config?.frameOptions?.contents?.[i]);
                });
            }
            element.appendChild(doc.documentElement);
        }
    };
    /**
     * UPDATE_POSITION_QRCODE_ON_FRAME
     * @returns HTMLElement
     */
    const UPDATE_POSITION_QRCODE_ON_FRAME = () => {
        const addsvg = element.querySelector('.addsvg');
        addsvg?.setAttribute("transform", `translate(${x},${y})`);
        return addsvg;
    };
    /**
     * UPDATE_ROTATE_SCALE_QRCODE_ON_FRAME
     * @param svg
     * @returns void
     */
    const UPDATE_ROTATE_SCALE_QRCODE_ON_FRAME = (svg) => {
        if (svg && config?.rotate) {
            svg?.childNodes?.[0]?.childNodes?.forEach((node) => {
                if (node.nodeName === 'rect') {
                    node.style.transformOrigin = `50% 50%`;
                    node.style.transform = `rotate(${config?.rotate ?? 0}deg)`;
                }
            });
        }
        if (svg && config?.scale) {
            svg?.childNodes?.[0]?.childNodes?.forEach((node) => {
                if (node.nodeName === 'rect') {
                    node.style.scale = config?.scale ?? 0;
                }
            });
        }
    };
    /**
     * CREATE_QRCODE_INTO_FRAME
     * @param addsvg
     * @returns
     */
    const CREATE_QRCODE_INTO_FRAME = (addsvg) => {
        const defaultConfig = () => {
            let deep = config && JSON.parse(JSON.stringify(config)); // deep
            deep = { ...deep, ...{ type: 'svg', data: window.unescape(encodeURIComponent(deep?.data ?? '')) } };
            delete deep.frameOptions;
            delete deep.template;
            return deep;
        };
        // removeChild
        while (container?.firstChild) {
            container.removeChild(container.lastChild);
        }
        const CR = new QRCodeStyling(defaultConfig());
        return CR?._svgDrawingPromise?.then(() => {
            CR.append(addsvg);
        }).catch((error) => console.error(error));
    };
    /**
     * QRCODE_TYPE_SVG
     * @returns
     */
    const QRCODE_TYPE_SVG = () => {
        if (config?.type === 'svg') {
            UPDATE_SIZE_SVG();
            container.appendChild(element);
            return true;
        }
        return false;
    };
    /**
     * CREATE_CANVAS_WITH_SIZE
     * @returns
     */
    const CREATE_CANVAS_WITH_SIZE = () => {
        const canvas = document.createElement('canvas');
        canvas.height = height;
        canvas.width = width;
        container.appendChild(canvas);
        return canvas;
    };
    /**
     * ELEMENT_CONVERT_TO_BASE64
     * @param s1
     * @returns
     */
    const ELEMENT_CONVERT_TO_BASE64 = (s1) => {
        let b64 = "data:image/svg+xml;base64,";
        const xml = s1 && new XMLSerializer().serializeToString(s1);
        return b64 += xml && btoa(unescape(encodeURIComponent(xml)));
    };
    /**
     * UPDATE_SIZE_SVG
     * @returns
     */
    const UPDATE_SIZE_SVG = () => {
        const s1 = element.querySelector(`#${styleName}_svg`);
        s1 && s1.setAttribute('height', `${height}px`);
        s1 && s1.setAttribute('width', `${width}px`);
        return s1;
    };
    /**
     * BASE64_TO_BLOB
     * @param base64Image
     * @returns
     */
    const BASE64_TO_BLOB = (base64Image) => {
        // Split into two parts
        const parts = base64Image.split(";base64,");
        // Hold the content type
        const imageType = parts[0].split(":")[1];
        // Decode Base64 string
        const decodedData = window.atob(parts[1]);
        // Create UNIT8ARRAY of size same as row data length
        const uInt8Array = new Uint8Array(decodedData.length);
        // Insert all character code into uInt8Array
        for (let i = 0; i < decodedData.length; ++i) {
            uInt8Array[i] = decodedData.charCodeAt(i);
        }
        // Return BLOB image after conversion
        return new Blob([uInt8Array], { type: imageType });
    };
    /**
     * CREATE_IMAGE
     */
    const CREATE_IMAGE = () => {
        const img = new Image();
        const ctx = CREATE_CANVAS_WITH_SIZE().getContext("2d");
        img.onload = function () {
            ctx && ctx.drawImage(img, 0, 0);
        };
        const blob = BASE64_TO_BLOB(ELEMENT_CONVERT_TO_BASE64(UPDATE_SIZE_SVG()));
        const blobUrl = URL.createObjectURL(blob);
        img.src = blobUrl;
    };
    /**
     * MAIN
     */
    (async function () {
        if (QRCODE_NONE_FRAME()) {
            subject.next({ config, container });
            subject.complete();
            return; // Mode qrcode basic
        }
        else {
            await ADD_FRAME_SVG_TO_ELEMENT();
            const ADDSVG = UPDATE_POSITION_QRCODE_ON_FRAME();
            await CREATE_QRCODE_INTO_FRAME(ADDSVG);
            UPDATE_ROTATE_SCALE_QRCODE_ON_FRAME(ADDSVG);
            if (QRCODE_TYPE_SVG()) {
                // Mode qrcode + frame type svg
                subject.next({ config, container });
                subject.complete();
            }
            else {
                // Mode qrcode + frame type canvas
                CREATE_IMAGE();
                subject.next({ config, container });
                subject.complete();
            }
        }
    })();
    return subject;
}
/**
 * defaultTemplate
 * @param config
 * @returns
 */
export const defaultTemplate = (config) => {
    let deep = config && JSON.parse(JSON.stringify(config));
    return config?.template ? { ...Templates(config.template.toLocaleLowerCase()), ...deep } : deep;
};
/**
 * deepUpdate
 * @param config
 * @param configUpdate
 * @returns
 */
export const deepUpdate = async (config, configUpdate) => {
    const origin = config && JSON.parse(JSON.stringify(config));
    let clone = { ...origin, ...configUpdate };
    const keys = ['frameOptions', 'qrOptions', 'imageOptions', 'dotsOptions', 'cornersSquareOptions', 'cornersDotOptions', 'backgroundOptions'];
    for await (const key of keys) {
        if (key in configUpdate) {
            const update = {
                [key]: { ...origin[key], ...configUpdate[key] }
            };
            clone = { ...clone, ...update };
        }
    }
    return clone;
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LXFyY29kZS1zdHlsaW5nLmhlbHBlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3Byb2plY3RzL25neC1xcmNvZGUtc3R5bGluZy9zcmMvbGliL25neC1xcmNvZGUtc3R5bGluZy5oZWxwZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxhQUFhLE1BQU0saUJBQWlCLENBQUM7QUFDNUMsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUdwQyxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0NBQWdDLENBQUM7QUFFM0Q7Ozs7O0dBS0c7QUFDSCxNQUFNLFVBQVUsVUFBVSxDQUFDLE1BQWUsRUFBRSxTQUFnRjtJQUV4SCxNQUFNLE9BQU8sR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO0lBRW5DLFNBQVM7SUFDVCxJQUFJLENBQUMsTUFBTSxJQUFJLENBQUMsU0FBUyxFQUFFO1FBQ3ZCLE9BQU8sQ0FBQyxLQUFLLENBQUMsb0NBQW9DLENBQUMsQ0FBQztRQUNwRCxPQUFPLENBQUMsUUFBUSxFQUFFLENBQUM7UUFDbkIsT0FBTyxPQUFPLENBQUM7S0FDbEI7SUFBQSxDQUFDO0lBRUYsTUFBTSxPQUFPLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUU5Qzs7O09BR0c7SUFDSCxNQUFNLGlCQUFpQixHQUFHLEdBQUcsRUFBRTtRQUMzQixJQUFJLE1BQU0sRUFBRSxZQUFZLEVBQUU7WUFDdEIsT0FBTyxLQUFLLENBQUM7U0FDaEI7YUFBTTtZQUNILE1BQU0sWUFBWSxHQUFHLEdBQUcsRUFBRTtnQkFDdEIsSUFBSSxJQUFJLEdBQUcsTUFBTSxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTztnQkFDaEUsT0FBTyxNQUFNLENBQUMsTUFBTSxDQUFDLEVBQUUsSUFBSSxFQUFHLE1B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QUFDLEVBQUUsR0FBRyxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO0FBQ3BHLENBQUMsQ0FBQztBQUVGOzs7OztHQUtHO0FBQ0gsTUFBTSxDQUFDLE1BQU0sVUFBVSxHQUFHLEtBQUssRUFBRSxNQUFlLEVBQUUsWUFBcUIsRUFBb0IsRUFBRTtJQUN6RixNQUFNLE1BQU0sR0FBRyxNQUFNLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7SUFDNUQsSUFBSSxLQUFLLEdBQUcsRUFBRSxHQUFHLE1BQU0sRUFBRSxHQUFHLFlBQVksRUFBRSxDQUFDO0lBQzNDLE1BQU0sSUFBSSxHQUFHLENBQUMsY0FBYyxFQUFFLFdBQVcsRUFBRSxjQUFjLEVBQUUsYUFBYSxFQUFFLHNCQUFzQixFQUFFLG1CQUFtQixFQUFFLG1CQUFtQixDQUFDLENBQUM7SUFDNUksSUFBSSxLQUFLLEVBQUUsTUFBTSxHQUFHLElBQUksSUFBSSxFQUFFO1FBQzFCLElBQUksR0FBRyxJQUFJLFlBQVksRUFBRTtZQUNyQixNQUFNLE1BQU0sR0FBRztnQkFDWCxDQUFDLEdBQUcsQ0FBQyxFQUFFLEVBQUUsR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFDLEVBQUUsR0FBSSxZQUFvQixDQUFDLEdBQUcsQ0FBQyxFQUFFO2FBQzNELENBQUM7WUFDRixLQUFLLEdBQUcsRUFBRSxHQUFHLEtBQUssRUFBRSxHQUFHLE1BQU0sRUFBRSxDQUFDO1NBQ25DO0tBQ0o7SUFDRCxPQUFPLEtBQUssQ0FBQztBQUNqQixDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUVJDb2RlU3R5bGluZyBmcm9tICdxci1jb2RlLXN0eWxpbmcnO1xyXG5pbXBvcnQgeyBBc3luY1N1YmplY3QgfSBmcm9tICdyeGpzJztcclxuXHJcbmltcG9ydCB7IE9wdGlvbnMgfSBmcm9tICcuL25neC1xcmNvZGUtc3R5bGluZy5vcHRpb25zJztcclxuaW1wb3J0IHsgVGVtcGxhdGVzIH0gZnJvbSAnLi9uZ3gtcXJjb2RlLXN0eWxpbmcudGVtcGxhdGVzJztcclxuXHJcbi8qKlxyXG4gKiBkcmF3UXJjb2RlXHJcbiAqIEBwYXJhbSBjb25maWcgXHJcbiAqIEBwYXJhbSBjb250YWluZXIgXHJcbiAqIEByZXR1cm5zIFxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGRyYXdRcmNvZGUoY29uZmlnOiBPcHRpb25zLCBjb250YWluZXI6IEhUTUxFbGVtZW50IHwgSFRNTFZpZGVvRWxlbWVudCB8IEhUTUxDYW52YXNFbGVtZW50IHwgU1ZHRWxlbWVudCB8IGFueSk6IEFzeW5jU3ViamVjdDxhbnk+IHtcclxuXHJcbiAgICBjb25zdCBzdWJqZWN0ID0gbmV3IEFzeW5jU3ViamVjdCgpO1xyXG5cclxuICAgIC8vIFJlamVjdFxyXG4gICAgaWYgKCFjb25maWcgfHwgIWNvbnRhaW5lcikge1xyXG4gICAgICAgIHN1YmplY3QuZXJyb3IoJ0NvbnRhaW5lciBvciBDb25maWcgbm90IGF2YWlsYWJsZSEnKTtcclxuICAgICAgICBzdWJqZWN0LmNvbXBsZXRlKCk7XHJcbiAgICAgICAgcmV0dXJuIHN1YmplY3Q7XHJcbiAgICB9O1xyXG5cclxuICAgIGNvbnN0IGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogUVJDT0RFX05PTkVfRlJBTUVcclxuICAgICAqIEByZXR1cm5zIFxyXG4gICAgICovXHJcbiAgICBjb25zdCBRUkNPREVfTk9ORV9GUkFNRSA9ICgpID0+IHtcclxuICAgICAgICBpZiAoY29uZmlnPy5mcmFtZU9wdGlvbnMpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGVuY29kZUNvbmZpZyA9ICgpID0+IHtcclxuICAgICAgICAgICAgICAgIGxldCBkZWVwID0gY29uZmlnICYmIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoY29uZmlnKSk7IC8vIGRlZXBcclxuICAgICAgICAgICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKHsgZGF0YTogKHdpbmRvdyBhcyBhbnkpLnVuZXNjYXBlKGVuY29kZVVSSUNvbXBvbmVudChkZWVwPy5kYXRhID8/ICcnKSkgfSwgZGVlcCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8gcmVtb3ZlQ2hpbGRcclxuICAgICAgICAgICAgd2hpbGUgKGNvbnRhaW5lci5maXJzdENoaWxkKSB7XHJcbiAgICAgICAgICAgICAgICBjb250YWluZXIucmVtb3ZlQ2hpbGQoY29udGFpbmVyLmxhc3RDaGlsZCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29uc3QgQ1IgPSBuZXcgUVJDb2RlU3R5bGluZyhlbmNvZGVDb25maWcoKSBhcyBPcHRpb25zKTtcclxuICAgICAgICAgICAgLy8gYXBwZW5kIHRvIGNvbnRhaW5lclxyXG4gICAgICAgICAgICBDUi5hcHBlbmQoY29udGFpbmVyKTtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHN0eWxlTmFtZSA9IGNvbmZpZz8uZnJhbWVPcHRpb25zPy5zdHlsZSA/PyAnRl8wMjAnO1xyXG4gICAgY29uc3QgaGVpZ2h0ID0gY29uZmlnPy5mcmFtZU9wdGlvbnM/LmhlaWdodCA/PyAzMDA7XHJcbiAgICBjb25zdCB3aWR0aCA9IGNvbmZpZz8uZnJhbWVPcHRpb25zPy53aWR0aCA/PyAzMDA7XHJcbiAgICBjb25zdCB4ID0gY29uZmlnPy5mcmFtZU9wdGlvbnM/LnggPz8gNTA7XHJcbiAgICBjb25zdCB5ID0gY29uZmlnPy5mcmFtZU9wdGlvbnM/LnkgPz8gNTA7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBBRERfRlJBTUVfU1ZHX1RPX0VMRU1FTlRcclxuICAgICAqIEByZXR1cm5zXHJcbiAgICAgKi9cclxuICAgIGNvbnN0IEFERF9GUkFNRV9TVkdfVE9fRUxFTUVOVCA9ICgpID0+IHtcclxuICAgICAgICBjb25zdCBodHRwID0gZmV0Y2goYGh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9pZDE5NDUvbmd4LXFyY29kZS1zdHlsaW5nL21hc3Rlci9zdmcvJHtzdHlsZU5hbWV9LnN2Z2AsIHsgbWV0aG9kOiAnR0VUJyB9KVxyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgICAgIGh0dHAudGhlbihyZXNwb25zZSA9PiByZXNwb25zZS50ZXh0KCkpLnRoZW4ocmVzdWx0ID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQgIT09IFwiNDA0OiBOb3QgRm91bmRcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIHVwZ3JhZGVTdmcocmVzdWx0KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0KTtcclxuICAgICAgICAgICAgfSkuY2F0Y2goZXJyb3IgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XHJcbiAgICAgICAgICAgICAgICByZWplY3QoZXJyb3IpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB1cGdyYWRlU3ZnID0gKHJlc3VsdDogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgY29uc3QgcGFyc2VyID0gbmV3IERPTVBhcnNlcigpO1xyXG4gICAgICAgIGNvbnN0IGRvYyA9IHBhcnNlci5wYXJzZUZyb21TdHJpbmcocmVzdWx0LCBcImltYWdlL3N2Zyt4bWxcIik7XHJcbiAgICAgICAgaWYgKGRvYykge1xyXG4gICAgICAgICAgICBjb25zdCBzdmdFbCA9IChkb2MuZG9jdW1lbnRFbGVtZW50LmNoaWxkcmVuIGFzIGFueSlbc3R5bGVOYW1lICsgJ19zdmcnXTtcclxuICAgICAgICAgICAgaWYgKCFzdmdFbCkgcmV0dXJuO1xyXG4gICAgICAgICAgICBjb25zdCB0ZXh0RWxzID0gc3ZnRWwuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShcImZyYW1lLXRleHRcIik7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbnRlbnRFbHMgPSBzdmdFbC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwiZnJhbWUtY29udGVudFwiKTtcclxuICAgICAgICAgICAgY29uc3QgY29udGFpbmVyRWxzID0gc3ZnRWwuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShcImZyYW1lLWNvbnRhaW5lclwiKTtcclxuICAgICAgICAgICAgY29uZmlnPy5mcmFtZU9wdGlvbnM/LmJhY2tncm91bmQgJiYgc3ZnRWwuc2V0QXR0cmlidXRlKCdzdHlsZScsYGJhY2tncm91bmQ6ICR7Y29uZmlnPy5mcmFtZU9wdGlvbnM/LmJhY2tncm91bmR9OyR7c3ZnRWw/LmdldEF0dHJpYnV0ZSgnc3R5bGUnKX1gKTtcclxuICAgICAgICAgICAgY29uc3QgdXBkYXRlU3R5bGUgPSAoZWw6IGFueSwgY29uZmlnOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChlbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3Qga2V5IGluIGNvbmZpZykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoKFsneCcsICd5JywgJ3RyYW5zZm9ybSddIGFzIGFueSkuaW5jbHVkZXMoa2V5KSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWwuc2V0QXR0cmlidXRlKGtleSwgY29uZmlnICYmIGNvbmZpZ1trZXldKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICgoWyd0ZXh0Q29udGVudCddIGFzIGFueSkuaW5jbHVkZXMoa2V5KSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxba2V5XSA9IGNvbmZpZyAmJiBjb25maWdba2V5XTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsLnN0eWxlW2tleV0gPSBjb25maWcgJiYgY29uZmlnW2tleV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGNyZWF0ZUVsZW1lbnROUyA9IChjb25maWc6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgc3ZnTlMgPSBcImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCI7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdUZXh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKHN2Z05TLCBcInRleHRcIik7XHJcbiAgICAgICAgICAgICAgICB1cGRhdGVTdHlsZShuZXdUZXh0LCBjb25maWcpO1xyXG4gICAgICAgICAgICAgICAgc3ZnRWwuYXBwZW5kQ2hpbGQobmV3VGV4dCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChjb25maWc/LmZyYW1lT3B0aW9ucz8udGV4dHMpIHtcclxuICAgICAgICAgICAgICAgIFsuLi5jb25maWcuZnJhbWVPcHRpb25zLnRleHRzXS5mb3JFYWNoKCh0ZXh0OiBhbnksIGk6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGVsID0gWy4uLnRleHRFbHNdPy5baV07XHJcbiAgICAgICAgICAgICAgICAgICAgZWwgPyB1cGRhdGVTdHlsZShlbCwgdGV4dCkgOiBjcmVhdGVFbGVtZW50TlModGV4dCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKGNvbmZpZz8uZnJhbWVPcHRpb25zPy5jb250YWluZXJzKSB7XHJcbiAgICAgICAgICAgICAgICBbLi4uY29udGFpbmVyRWxzXS5mb3JFYWNoKChlbDogYW55LCBpOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB1cGRhdGVTdHlsZShlbCwgY29uZmlnPy5mcmFtZU9wdGlvbnM/LmNvbnRhaW5lcnM/LltpXSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKGNvbmZpZz8uZnJhbWVPcHRpb25zPy5jb250ZW50cykge1xyXG4gICAgICAgICAgICAgICAgWy4uLmNvbnRlbnRFbHNdLmZvckVhY2goKGVsOiBhbnksIGk6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZVN0eWxlKGVsLCBjb25maWc/LmZyYW1lT3B0aW9ucz8uY29udGVudHM/LltpXSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZWxlbWVudC5hcHBlbmRDaGlsZChkb2MuZG9jdW1lbnRFbGVtZW50KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBVUERBVEVfUE9TSVRJT05fUVJDT0RFX09OX0ZSQU1FXHJcbiAgICAgKiBAcmV0dXJucyBIVE1MRWxlbWVudFxyXG4gICAgICovXHJcbiAgICBjb25zdCBVUERBVEVfUE9TSVRJT05fUVJDT0RFX09OX0ZSQU1FID0gKCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGFkZHN2ZyA9IGVsZW1lbnQucXVlcnlTZWxlY3RvcignLmFkZHN2ZycpO1xyXG4gICAgICAgIGFkZHN2Zz8uc2V0QXR0cmlidXRlKFwidHJhbnNmb3JtXCIsIGB0cmFuc2xhdGUoJHt4fSwke3l9KWApO1xyXG4gICAgICAgIHJldHVybiBhZGRzdmcgYXMgSFRNTEVsZW1lbnQ7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBVUERBVEVfUk9UQVRFX1NDQUxFX1FSQ09ERV9PTl9GUkFNRVxyXG4gICAgICogQHBhcmFtIHN2Z1xyXG4gICAgICogQHJldHVybnMgdm9pZFxyXG4gICAgICovXHJcbiAgICBjb25zdCBVUERBVEVfUk9UQVRFX1NDQUxFX1FSQ09ERV9PTl9GUkFNRSA9IChzdmc6IEhUTUxFbGVtZW50KSA9PiB7XHJcbiAgICAgICAgaWYgKHN2ZyAmJiBjb25maWc/LnJvdGF0ZSkge1xyXG4gICAgICAgICAgICBzdmc/LmNoaWxkTm9kZXM/LlswXT8uY2hpbGROb2Rlcz8uZm9yRWFjaCgobm9kZTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAobm9kZS5ub2RlTmFtZSA9PT0gJ3JlY3QnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbm9kZS5zdHlsZS50cmFuc2Zvcm1PcmlnaW4gPSBgNTAlIDUwJWA7XHJcbiAgICAgICAgICAgICAgICAgICAgbm9kZS5zdHlsZS50cmFuc2Zvcm0gPSBgcm90YXRlKCR7Y29uZmlnPy5yb3RhdGUgPz8gMH1kZWcpYDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChzdmcgJiYgY29uZmlnPy5zY2FsZSkge1xyXG4gICAgICAgICAgICBzdmc/LmNoaWxkTm9kZXM/LlswXT8uY2hpbGROb2Rlcz8uZm9yRWFjaCgobm9kZTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAobm9kZS5ub2RlTmFtZSA9PT0gJ3JlY3QnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbm9kZS5zdHlsZS5zY2FsZSA9IGNvbmZpZz8uc2NhbGUgPz8gMDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQ1JFQVRFX1FSQ09ERV9JTlRPX0ZSQU1FXHJcbiAgICAgKiBAcGFyYW0gYWRkc3ZnIFxyXG4gICAgICogQHJldHVybnMgXHJcbiAgICAgKi9cclxuICAgIGNvbnN0IENSRUFURV9RUkNPREVfSU5UT19GUkFNRSA9IChhZGRzdmc6IEhUTUxFbGVtZW50KSA9PiB7XHJcbiAgICAgICAgY29uc3QgZGVmYXVsdENvbmZpZyA9ICgpID0+IHtcclxuICAgICAgICAgICAgbGV0IGRlZXAgPSBjb25maWcgJiYgSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShjb25maWcpKTsgLy8gZGVlcFxyXG4gICAgICAgICAgICBkZWVwID0geyAuLi5kZWVwLCAuLi57IHR5cGU6ICdzdmcnLCBkYXRhOiAod2luZG93IGFzIGFueSkudW5lc2NhcGUoZW5jb2RlVVJJQ29tcG9uZW50KGRlZXA/LmRhdGEgPz8gJycpKSB9IH07XHJcbiAgICAgICAgICAgIGRlbGV0ZSBkZWVwLmZyYW1lT3B0aW9ucztcclxuICAgICAgICAgICAgZGVsZXRlIGRlZXAudGVtcGxhdGU7XHJcbiAgICAgICAgICAgIHJldHVybiBkZWVwO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyByZW1vdmVDaGlsZFxyXG4gICAgICAgIHdoaWxlIChjb250YWluZXI/LmZpcnN0Q2hpbGQpIHtcclxuICAgICAgICAgICAgY29udGFpbmVyLnJlbW92ZUNoaWxkKGNvbnRhaW5lci5sYXN0Q2hpbGQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBDUiA9IG5ldyBRUkNvZGVTdHlsaW5nKGRlZmF1bHRDb25maWcoKSBhcyBPcHRpb25zKTtcclxuICAgICAgICByZXR1cm4gQ1I/Ll9zdmdEcmF3aW5nUHJvbWlzZT8udGhlbigoKSA9PiB7XHJcbiAgICAgICAgICAgIENSLmFwcGVuZChhZGRzdmcpO1xyXG4gICAgICAgIH0pLmNhdGNoKChlcnJvcjogYW55KSA9PiBjb25zb2xlLmVycm9yKGVycm9yKSlcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFFSQ09ERV9UWVBFX1NWR1xyXG4gICAgICogQHJldHVybnMgXHJcbiAgICAgKi9cclxuICAgIGNvbnN0IFFSQ09ERV9UWVBFX1NWRyA9ICgpID0+IHtcclxuICAgICAgICBpZiAoY29uZmlnPy50eXBlID09PSAnc3ZnJykge1xyXG4gICAgICAgICAgICBVUERBVEVfU0laRV9TVkcoKTtcclxuICAgICAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGVsZW1lbnQpO1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQ1JFQVRFX0NBTlZBU19XSVRIX1NJWkVcclxuICAgICAqIEByZXR1cm5zIFxyXG4gICAgICovXHJcbiAgICBjb25zdCBDUkVBVEVfQ0FOVkFTX1dJVEhfU0laRSA9ICgpID0+IHtcclxuICAgICAgICBjb25zdCBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTtcclxuICAgICAgICBjYW52YXMuaGVpZ2h0ID0gaGVpZ2h0O1xyXG4gICAgICAgIGNhbnZhcy53aWR0aCA9IHdpZHRoO1xyXG4gICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChjYW52YXMpO1xyXG4gICAgICAgIHJldHVybiBjYW52YXM7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBFTEVNRU5UX0NPTlZFUlRfVE9fQkFTRTY0XHJcbiAgICAgKiBAcGFyYW0gczEgXHJcbiAgICAgKiBAcmV0dXJucyBcclxuICAgICAqL1xyXG4gICAgY29uc3QgRUxFTUVOVF9DT05WRVJUX1RPX0JBU0U2NCA9IChzMTogSFRNTEVsZW1lbnQpID0+IHtcclxuICAgICAgICBsZXQgYjY0ID0gXCJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFwiO1xyXG4gICAgICAgIGNvbnN0IHhtbCA9IHMxICYmIG5ldyBYTUxTZXJpYWxpemVyKCkuc2VyaWFsaXplVG9TdHJpbmcoczEpO1xyXG4gICAgICAgIHJldHVybiBiNjQgKz0geG1sICYmIGJ0b2EodW5lc2NhcGUoZW5jb2RlVVJJQ29tcG9uZW50KHhtbCkpKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFVQREFURV9TSVpFX1NWR1xyXG4gICAgICogQHJldHVybnMgXHJcbiAgICAgKi9cclxuICAgIGNvbnN0IFVQREFURV9TSVpFX1NWRyA9ICgpID0+IHtcclxuICAgICAgICBjb25zdCBzMSA9IGVsZW1lbnQucXVlcnlTZWxlY3RvcihgIyR7c3R5bGVOYW1lfV9zdmdgKTtcclxuICAgICAgICBzMSAmJiBzMS5zZXRBdHRyaWJ1dGUoJ2hlaWdodCcsIGAke2hlaWdodH1weGApO1xyXG4gICAgICAgIHMxICYmIHMxLnNldEF0dHJpYnV0ZSgnd2lkdGgnLCBgJHt3aWR0aH1weGApO1xyXG4gICAgICAgIHJldHVybiBzMSBhcyBIVE1MRWxlbWVudDtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEJBU0U2NF9UT19CTE9CXHJcbiAgICAgKiBAcGFyYW0gYmFzZTY0SW1hZ2UgXHJcbiAgICAgKiBAcmV0dXJucyBcclxuICAgICAqL1xyXG4gICAgY29uc3QgQkFTRTY0X1RPX0JMT0IgPSAoYmFzZTY0SW1hZ2U6IHN0cmluZykgPT4ge1xyXG4gICAgICAgIC8vIFNwbGl0IGludG8gdHdvIHBhcnRzXHJcbiAgICAgICAgY29uc3QgcGFydHMgPSBiYXNlNjRJbWFnZS5zcGxpdChcIjtiYXNlNjQsXCIpO1xyXG4gICAgICAgIC8vIEhvbGQgdGhlIGNvbnRlbnQgdHlwZVxyXG4gICAgICAgIGNvbnN0IGltYWdlVHlwZSA9IHBhcnRzWzBdLnNwbGl0KFwiOlwiKVsxXTtcclxuICAgICAgICAvLyBEZWNvZGUgQmFzZTY0IHN0cmluZ1xyXG4gICAgICAgIGNvbnN0IGRlY29kZWREYXRhID0gd2luZG93LmF0b2IocGFydHNbMV0pO1xyXG4gICAgICAgIC8vIENyZWF0ZSBVTklUOEFSUkFZIG9mIHNpemUgc2FtZSBhcyByb3cgZGF0YSBsZW5ndGhcclxuICAgICAgICBjb25zdCB1SW50OEFycmF5ID0gbmV3IFVpbnQ4QXJyYXkoZGVjb2RlZERhdGEubGVuZ3RoKTtcclxuICAgICAgICAvLyBJbnNlcnQgYWxsIGNoYXJhY3RlciBjb2RlIGludG8gdUludDhBcnJheVxyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZGVjb2RlZERhdGEubGVuZ3RoOyArK2kpIHtcclxuICAgICAgICAgICAgdUludDhBcnJheVtpXSA9IGRlY29kZWREYXRhLmNoYXJDb2RlQXQoaSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIFJldHVybiBCTE9CIGltYWdlIGFmdGVyIGNvbnZlcnNpb25cclxuICAgICAgICByZXR1cm4gbmV3IEJsb2IoW3VJbnQ4QXJyYXldLCB7IHR5cGU6IGltYWdlVHlwZSB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIENSRUFURV9JTUFHRVxyXG4gICAgICovXHJcbiAgICBjb25zdCBDUkVBVEVfSU1BR0UgPSAoKSA9PiB7XHJcbiAgICAgICAgY29uc3QgaW1nID0gbmV3IEltYWdlKCk7XHJcbiAgICAgICAgY29uc3QgY3R4ID0gQ1JFQVRFX0NBTlZBU19XSVRIX1NJWkUoKS5nZXRDb250ZXh0KFwiMmRcIik7XHJcbiAgICAgICAgaW1nLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgY3R4ICYmIGN0eC5kcmF3SW1hZ2UoaW1nLCAwLCAwKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIGNvbnN0IGJsb2IgPSBCQVNFNjRfVE9fQkxPQihFTEVNRU5UX0NPTlZFUlRfVE9fQkFTRTY0KFVQREFURV9TSVpFX1NWRygpKSk7XHJcbiAgICAgICAgY29uc3QgYmxvYlVybCA9IFVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7XHJcbiAgICAgICAgaW1nLnNyYyA9IGJsb2JVcmw7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBNQUlOXHJcbiAgICAgKi9cclxuICAgIChhc3luYyBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKFFSQ09ERV9OT05FX0ZSQU1FKCkpIHtcclxuICAgICAgICAgICAgc3ViamVjdC5uZXh0KHsgY29uZmlnLCBjb250YWluZXIgfSk7XHJcbiAgICAgICAgICAgIHN1YmplY3QuY29tcGxldGUoKTtcclxuICAgICAgICAgICAgcmV0dXJuIC8vIE1vZGUgcXJjb2RlIGJhc2ljXHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgYXdhaXQgQUREX0ZSQU1FX1NWR19UT19FTEVNRU5UKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IEFERFNWRyA9IFVQREFURV9QT1NJVElPTl9RUkNPREVfT05fRlJBTUUoKTtcclxuICAgICAgICAgICAgYXdhaXQgQ1JFQVRFX1FSQ09ERV9JTlRPX0ZSQU1FKEFERFNWRyk7XHJcbiAgICAgICAgICAgIFVQREFURV9ST1RBVEVfU0NBTEVfUVJDT0RFX09OX0ZSQU1FKEFERFNWRyk7XHJcbiAgICAgICAgICAgIGlmIChRUkNPREVfVFlQRV9TVkcoKSkge1xyXG4gICAgICAgICAgICAgICAgLy8gTW9kZSBxcmNvZGUgKyBmcmFtZSB0eXBlIHN2Z1xyXG4gICAgICAgICAgICAgICAgc3ViamVjdC5uZXh0KHsgY29uZmlnLCBjb250YWluZXIgfSk7XHJcbiAgICAgICAgICAgICAgICBzdWJqZWN0LmNvbXBsZXRlKCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyBNb2RlIHFyY29kZSArIGZyYW1lIHR5cGUgY2FudmFzXHJcbiAgICAgICAgICAgICAgICBDUkVBVEVfSU1BR0UoKTtcclxuICAgICAgICAgICAgICAgIHN1YmplY3QubmV4dCh7IGNvbmZpZywgY29udGFpbmVyIH0pO1xyXG4gICAgICAgICAgICAgICAgc3ViamVjdC5jb21wbGV0ZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfSkoKTtcclxuXHJcbiAgICByZXR1cm4gc3ViamVjdDtcclxufVxyXG5cclxuXHJcbi8qKlxyXG4gKiBkZWZhdWx0VGVtcGxhdGVcclxuICogQHBhcmFtIGNvbmZpZyBcclxuICogQHJldHVybnMgXHJcbiAqL1xyXG5leHBvcnQgY29uc3QgZGVmYXVsdFRlbXBsYXRlID0gKGNvbmZpZz86IE9wdGlvbnMpOiBPcHRpb25zID0+IHtcclxuICAgIGxldCBkZWVwID0gY29uZmlnICYmIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoY29uZmlnKSk7XHJcbiAgICByZXR1cm4gY29uZmlnPy50ZW1wbGF0ZSA/IHsgLi4uVGVtcGxhdGVzKGNvbmZpZy50ZW1wbGF0ZS50b0xvY2FsZUxvd2VyQ2FzZSgpKSwgLi4uZGVlcCB9IDogZGVlcDtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBkZWVwVXBkYXRlXHJcbiAqIEBwYXJhbSBjb25maWcgXHJcbiAqIEBwYXJhbSBjb25maWdVcGRhdGUgXHJcbiAqIEByZXR1cm5zIFxyXG4gKi9cclxuZXhwb3J0IGNvbnN0IGRlZXBVcGRhdGUgPSBhc3luYyAoY29uZmlnOiBPcHRpb25zLCBjb25maWdVcGRhdGU6IE9wdGlvbnMpOiBQcm9taXNlPE9wdGlvbnM+ID0+IHtcclxuICAgIGNvbnN0IG9yaWdpbiA9IGNvbmZpZyAmJiBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGNvbmZpZykpO1xyXG4gICAgbGV0IGNsb25lID0geyAuLi5vcmlnaW4sIC4uLmNvbmZpZ1VwZGF0ZSB9O1xyXG4gICAgY29uc3Qga2V5cyA9IFsnZnJhbWVPcHRpb25zJywgJ3FyT3B0aW9ucycsICdpbWFnZU9wdGlvbnMnLCAnZG90c09wdGlvbnMnLCAnY29ybmVyc1NxdWFyZU9wdGlvbnMnLCAnY29ybmVyc0RvdE9wdGlvbnMnLCAnYmFja2dyb3VuZE9wdGlvbnMnXTtcclxuICAgIGZvciBhd2FpdCAoY29uc3Qga2V5IG9mIGtleXMpIHtcclxuICAgICAgICBpZiAoa2V5IGluIGNvbmZpZ1VwZGF0ZSkge1xyXG4gICAgICAgICAgICBjb25zdCB1cGRhdGUgPSB7XHJcbiAgICAgICAgICAgICAgICBba2V5XTogeyAuLi5vcmlnaW5ba2V5XSwgLi4uKGNvbmZpZ1VwZGF0ZSBhcyBhbnkpW2tleV0gfVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBjbG9uZSA9IHsgLi4uY2xvbmUsIC4uLnVwZGF0ZSB9O1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBjbG9uZTtcclxufTtcclxuIl19